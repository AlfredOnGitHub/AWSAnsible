---
- name: Idempotency
  hosts: localhost
  vars_files:
    - ../keycred
  environment:
    AWS_ACCESS_KEY_ID: "{{ USER }}"
    AWS_SECRET_ACCESS_KEY: "{{ PASSWORD }}"
  vars:
    ansible_python_interpreter: /usr/bin/python3
    instance_type: "{{ INSTANCE_TYPE | default( 't2.micro' ) }}"
    instance_image: "{{ INSTANCE_IMAGE | default( 'ami-0f5457ab1b6214674' ) }}"
  tasks:
    - name: Get info about the instances
      ec2_instance_info:
        filters:
          "tag:Name": server1
          instance-state-name: running 
        region: us-east-2
      register: output

    - debug:
        msg: "{{ output.instances[0] }}"
      register: result
      ignore_errors: yes

    - debug:
        msg: "{{ result }}"
      when: result is failed    